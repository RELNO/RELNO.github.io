<script>
  $(document).ready(function () {
    // Get the current path or default to 'about'
    const currentPath =
      window.location.pathname.substring(1).replace(/\/+$/, "") || "about";
    loadContent(currentPath, false);

    // Handle clicks on navigation links
    $(".nav-link").click(function (event) {
      event.preventDefault();
      const href = $(this).attr("href");
      const page = href.substring(1).replace(/\/+$/, ""); // Remove leading slash and trailing slashes
      navigateTo(page);

      // Highlight active nav item
      $(".nav-link").removeClass("active");
      $(this).addClass("active");
    });

    // Handle browser back/forward buttons
    window.addEventListener("popstate", function (event) {
      if (event.state && event.state.page) {
        loadContent(event.state.page, false);
        updateActiveNavItem(event.state.page);
      }
    });

    // Initially highlight the active nav item
    updateActiveNavItem(currentPath);
  });

  // Function to normalize path by removing trailing slashes
  function normalizePath(path) {
    return path ? path.replace(/\/+$/, "") : path;
  }

  // Function to update active nav item
  function updateActiveNavItem(page) {
    page = page.replace(/\/+$/, "");
    $(".nav-link").removeClass("active");
    $(".nav-link[href='/" + page + "']").addClass("active");
  }

  // Navigate to a page and update browser history
  function navigateTo(page) {
    page = page.replace(/\/+$/, "");
    // Update browser history
    history.pushState({ page: page }, "", "/" + page);

    // Load the content
    loadContent(page, true);
  }

  // load content from the pages
  function loadContent(page, collapseNav) {
    // Extract the base page name without any path components
    const basePage = page.split("/").pop();

    // If page has directory structure, respect it, otherwise use page as directory
    const contentPath = page.includes("/")
      ? page + ".html"
      : page + "/" + page + ".html";

    $("#main-content").load(contentPath, function (response, status, xhr) {
      if (status == "error") {
        // Fallback to traditional path if the first attempt fails
        $("#main-content").load(page + "/" + page + ".html", function (
          response,
          status,
          xhr
        ) {
          if (status == "error") {
            $("#main-content").html(
              "<div class='container'><h2>Page not found</h2><p>Sorry, the requested page could not be loaded.</p></div>"
            );
          }
        });
        return;
      }

      // Update page title based on the loaded content
      document.title =
        "Ariel Noyman - " + page.charAt(0).toUpperCase() + page.slice(1);

      // Only collapse the navbar on mobile screens
      if (collapseNav && window.innerWidth < 992) {
        $("#navbarResponsive").collapse("hide");
      }

      // Update active nav item
      updateActiveNavItem(page);
    });
  }
</script>

<nav
  class="navbar navbar-expand-lg bg-secondary fixed-top text-uppercase"
  id="mainNav"
>
  <a
    class="close-navbar-toggler collapsed"
    data-toggle="collapse"
    data-target="#navbarResponsive"
    aria-controls="navbarResponsive"
    aria-expanded="false"
    aria-label="Toggle navigation"
  >
  </a>

  <div class="container">
    <a class="navbar-brand nav-link js-scroll-trigger" href="/about"
      >Ariel Noyman</a
    >
    <button
      class="navbar-toggler navbar-toggler-right text-uppercase bg-primary text-white rounded"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarResponsive"
      aria-controls="navbarResponsive"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <i class="fas fa-bars"></i>
    </button>

    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto m-auto">
        <li class="nav-item mx-0 mx-lg-1">
          <a class="nav-link rounded" href="/about">About</a>
        </li>
        <li class="nav-item mx-0 mx-lg-1">
          <a class="nav-link rounded" href="/portfolio">Projects</a>
        </li>
        <li class="nav-item mx-0 mx-lg-1">
          <a class="nav-link rounded" href="/talks">Talks</a>
        </li>
        <li class="nav-item mx-0 mx-lg-1">
          <a class="nav-link rounded" href="/news">News</a>
        </li>
        <li class="nav-item mx-0 mx-lg-1">
          <a class="nav-link rounded" href="/p_a">Publications & Awards</a>
        </li>
      </ul>

      <a
        class="btn btn-outline-black btn-social text-center rounded-circle"
        href="https://twitter.com/relnox"
        target="_blank"
        data-link-name="Twitter"
      >
        <i class="fab fa-twitter" style="font-size: 20px;"></i>
      </a>
      <a
        class="btn btn-outline-black btn-social text-center rounded-circle"
        href="https://www.linkedin.com/in/arielnoyman"
        target="_blank"
        data-link-name="LinkedIn"
      >
        <i class="fab fa-linkedin" style="font-size: 20px;"></i>
      </a>
      <a
        class="btn btn-outline-black btn-social text-center rounded-circle"
        href="https://github.com/RELNO"
        target="_blank"
        data-link-name="GitHub"
      >
        <i class="fab fa-github" style="font-size: 20px;"></i>
      </a>
      <a
        class="btn btn-outline-black btn-social text-center rounded-circle"
        href="https://www.youtube.com/user/arielnoyman"
        target="_blank"
        data-link-name="YouTube"
      >
        <i class="fab fa-youtube" style="font-size: 20px;"></i>
      </a>

      <a
        href="https://github.com/RELNO/resume/releases/download/latest/resume.pdf"
        target="_blank"
        class="btn btn-outline-black btn-social text-center rounded-circle"
        data-link-name="CV"
      >
        <i class="fas fa-file-alt" style="font-size: 20px;"></i>
      </a>

      <a
        class="btn btn-outline-black btn-social text-center rounded-circle"
        href="noyman_pf_25.pdf"
        target="_blank"
        data-link-name="Portfolio"
      >
        <i class="fas fa-book" style="font-size: 20px;"></i>
      </a>
    </div>
  </div>
</nav>
